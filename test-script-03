#!/usr/bin/env bash
# NAME=test-script-03
# VERSION=0.0.1
# DESCRIPTION=Petit script de test généré via template
# PRESENTATION_START
# Titre court de présentation (facultatif)
#
# Un paragraphe d’introduction sur ce que fait le script.
# Tu peux laisser des lignes vides pour aérer.
#
# - Points principaux en liste à puces
# - Chaque point commence par un tiret `-`
# - Pas besoin d’indentation spéciale
#
# 1. Tu peux aussi faire des listes numérotées
# 2. Il suffit de commencer la ligne par `1.`, `2.`, etc.
#
# Exemple rapide d’usage en texte :
# `mon-script --option valeur`
#
# Astuce : on peut mettre un mot en *italique* ou en **gras** si ton rendu Hugo l’autorise.
# PRESENTATION_END
# HOMEPAGE=https://github.com/NoelNac-HackEthical/mes-scripts
#____________________________________________________________________________
#
# Bref résumé :
#   Petit script de test généré via template
#
# Template minimal pour scripts mes-scripts :
# - contient usage() et examples() en heredoc (extraits par la pipeline)
# - contient _version_str / _print_version_and_exit pour être cohérent
#
set -euo pipefail

# ---------------------------------------------------------------------------
# Helpers version (ne pas modifier)
_self_path="${BASH_SOURCE[0]:-$0}"
if command -v readlink >/dev/null 2>&1; then
  _resolved="$(readlink -f -- "$_self_path" 2>/dev/null || true)"
  [ -n "$_resolved" ] && _self_path="$_resolved"
fi
_self_base="$(basename "$_self_path")"

_version_str(){
  # lit la première occurrence '# VERSION=' dans le fichier source (robuste CRLF)
  local v
  v="$(awk -F= '/^# *VERSION *=/ { gsub(/\r$/,"",$2); print $2; exit }' "$_self_path" 2>/dev/null || true)"
  v="${v:-0.0.0}"
  printf '%s v%s\n' "$_self_base" "$v"
}
_print_version_and_exit(){ _version_str; exit 0; }
# ---------------------------------------------------------------------------

# ---------------------------------------------------------------------------
# USAGE (heredoc) — extrait automatiquement par la pipeline
usage(){
  cat <<USAGE
Usage: ${_self_base} [OPTIONS] <args>

Short description:
  Petit script de test généré via template

Options:
  -h, --help     Show this help
  -V, --version  Show version
  --debug        Debug mode (set -x)
USAGE
}
# ---------------------------------------------------------------------------

# ---------------------------------------------------------------------------
# EXAMPLES / ASTUCES (optionnel ; extrait si présent)
examples(){
  cat <<EXAMPLES
# Basic example
${_self_base} arg1 arg2

# Advanced example (edit as needed)
# ${_self_base} --option value target
EXAMPLES
}
# ---------------------------------------------------------------------------

# ---------------------------------------------------------------------------
# Parsing minimal CLI (classique)
DEBUG=false

# Aides rapides
if [[ "${1:-}" == "--version" || "${1:-}" == "-V" ]]; then
  _print_version_and_exit
fi
if [[ "${1:-}" == "--help" || "${1:-}" == "-h" ]]; then
  _version_str
  usage
  exit 0
fi

# Boucle d'options basique (à compléter selon le script)
while [[ $# -gt 0 ]]; do
  case "$1" in
    --debug) DEBUG=true; shift ;;
    -V|--version) _print_version_and_exit ;;
    -h|--help) _version_str; usage; exit 0 ;;
    --) shift; break ;;
    -*) echo "Unknown option: $1" >&2; usage; exit 2 ;;
    *) break ;;  # positions
  esac
done
# ---------------------------------------------------------------------------

_main(){
  # Exemple de squelette (remplacer par la logique du script généré)
  if [ "$DEBUG" = true ]; then set -x; fi

  echo "Script: $(_version_str)"
  echo "Args  : $*"

  # TODO: implémentation
  return 0
}

# Exécuter _main si appelé directement
if [[ "${BASH_SOURCE[0]}" == "$0" ]]; then
  _main "$@"
fi
